window.GFMollie=null,gform.extensions=gform.extensions||{},gform.extensions.styles=gform.extensions.styles||{},gform.extensions.styles.gravityformsmollie=gform.extensions.styles.gravityformsmollie||{},function(r){GFMollie=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);var s=this;this.mollie=null,this.form=null,this.ccfields=null,this.activeFeed=null,this.feedActivated=!1,this.cardHasError={},this.cardHolder=this.cardNumber=this.cardNumberInput=this.expiryDate=this.verificationCode=null,this.cardStyle=this.cardStyle||{},gform.extensions.styles.gravityformsmollie[this.formId]=gform.extensions.styles.gravityformsmollie[this.formId]||{},this.componentStyles=gform.extensions.styles.gravityformsmollie[this.formId][this.pageInstance]||{},this.setComponentStyleValue=function(e,t,i,o){let r="";var n;return(r=0===t.indexOf("--")?(n=i.getPropertyValue(t))?"backgroundColor"!==e&&"color"!==e||!n.includes("rgba( ")&&!n.includes("rgb( ")?n:n.includes("rgba( ")?n.replace("rgba( ","rgba("):n.replace("rgb( ","rgb("):(o?getComputedStyle(o):i).getPropertyValue(("fontSmoothing"===e?"-webkit-font-smoothing":e).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()):t).trim()},this.setComponentStyles=function(e,i,o){if(0!==Object.keys(e).length){var t=document.getElementById("gform_"+this.formId);const r=getComputedStyle(t),n=t.querySelector(".gfield input");Object.keys(e).forEach(t=>{if("object"==typeof e[t])o||(s.cardStyle[t]={}),o&&(s.cardStyle[o][t]={}),this.setComponentStyles(e[t],t,o||t);else if("object"!=typeof e[t]){let e="";o?i&&i!==o?(e=this.setComponentStyleValue(t,s.componentStyles[o][i][t],r,n))&&(s.cardStyle[o][i][t]=e):(e=this.setComponentStyleValue(t,s.componentStyles[o][t],r,n))&&(s.cardStyle[o][t]=e):(e=this.setComponentStyleValue(t,s.componentStyles[t],r,n))&&(s.cardStyle[t]=e)}})}},this.setComponentStyles(s.componentStyles),this.init=function(){this.form=r("#gform_"+this.formId),this.ccfields="#field_"+this.formId+"_"+this.ccFieldId,this.cardNumberInput="#input_"+this.formId+"_"+this.ccFieldId+"_1",this.bindFormSubmit(),this.isPaymentFieldOnPage()&&(this.bindSetPaymentMethod(),this.bindFrontendFeedsEvaluated())},this.bindFormSubmit=function(){this.form.on("submit",function(e){s.clearError(),s.feedActivated&&s.isCreditCardMethodSelected(s.formId)&&"1"!==r("#gform_save_"+s.formId).val()&&!r(this).data("gfmolliesubmitting")&&s.isPaymentFieldOnPage()&&(s.isGoPrevPage(s.formId)?s.clearCardToken(s.formId):s.getCardToken(s.formId)&&!s.isPaymentFieldOnPage()||(e.preventDefault(),r(s.form).data("gfmolliesubmitting")||r(s.form).data("gfmolliesubmitting",!0),s.handleFormSubmit()))})},this.bindFrontendFeedsEvaluated=function(){gform.addAction("gform_frontend_feeds_evaluated",function(e,t){if(t===s.formId){s.feedActivated=!1;for(var i=0;i<Object.keys(e).length;i++)if("gravityformsmollie"===e[i].addonSlug&&e[i].isActivated){s.feedActivated=!0;for(var o=0;o<Object.keys(s.feeds).length;o++)if(s.feeds[o].feedId===e[i].feedId){s.activeFeed=s.feeds[o];break}break}s.feedActivated?(s.maybeShowMollieField(s.formId),s.maybeShowCcFields(s.formId)):(s.activeFeed=null,s.unmountMollieComponents(),r(".gfield_mollie").hide())}})},this.bindSetPaymentMethod=function(){""!==this.profileId&&(this.mollie=Mollie(this.profileId,{locale:gform_mollie_components_strings.locale,testmode:this.testMode,loglevel:1})),r(".ginput_mollie_payment_method select").on("change",function(){s.clearError(),s.maybeShowCcFields(s.formId)})},this.createMollieComponents=function(){var e;""!==this.profileId&&null===this.cardNumber&&(e={styles:s.cardStyle},this.cardHolder=s.mollie.createComponent("cardHolder",e),this.cardNumber=s.mollie.createComponent("cardNumber",e),this.expiryDate=s.mollie.createComponent("expiryDate",e),this.verificationCode=s.mollie.createComponent("verificationCode",e))},this.mountMollieComponents=function(){""===this.profileId||r(this.cardNumberInput).find(".mollie-component").length||(this.cardHolder.mount("#input_"+this.formId+"_"+this.ccFieldId+"_5"),this.cardNumber.mount(this.cardNumberInput),this.expiryDate.mount("#input_"+this.formId+"_"+this.ccFieldId+"_2"),this.verificationCode.mount("#input_"+this.formId+"_"+this.ccFieldId+"_3"),this.cardNumber.addEventListener("focus",function(e){wp.a11y.speak(r("#field_"+s.formId+"_"+s.ccFieldId+"_supported_creditcards").text()),s.clearError()}),this.cardNumber.addEventListener("change",this.handleComponentError),this.cardHolder.addEventListener("change",this.handleComponentError),this.expiryDate.addEventListener("change",this.handleComponentError),this.verificationCode.addEventListener("change",this.handleComponentError))},this.unmountMollieComponents=function(){r(this.cardNumberInput).find(".mollie-component").length&&(this.cardNumber.unmount(),this.cardHolder.unmount(),this.expiryDate.unmount(),this.verificationCode.unmount(),this.hideCcFields(s.formId))},this.handleComponentError=function(e){if(e.error&&e.touched){e={type:this.type,message:e.error};s.showError(e)}else if(s.clearError(),delete s.cardHasError[this.type],Object.keys(s.cardHasError).length)for(var t=["cardNumber","expiryDate","verificationCode","cardHolder"],i=0;i<t.length;i++){var o=t[i];if(s.cardHasError.hasOwnProperty(o))return s.showError({type:o,message:s.cardHasError[o]}),!1}},this.handleFormSubmit=function(){gformAddSpinner(s.formId),s.mollie.createToken().then(function(e){e.error?(e.error.message&&s.showError(e.error),s.resetMollieStatus()):(s.addTokenInputToForm(e.token,s.formId),s.form.submit())})},this.paymentMethodSelected=function(e){var t,i=this.form.find(".ginput_mollie_payment_method select").val();return null===i&&(t=this.form.find(".ginput_mollie_payment_method select option[selected]")).length&&(this.form.find(".ginput_mollie_payment_method select").val(t.val()),i=t.val()),i},this.isCreditCardMethodSelected=function(e){return"creditcard"===this.paymentMethodSelected(e)},this.isConversationalForm=function(){return"undefined"!=typeof gfcf_theme_config&&(null!==gfcf_theme_config&&void 0!==gfcf_theme_config.data?gfcf_theme_config.data.is_conversational_form:void 0)},this.maybeShowMollieField=function(e){1===this.form.find(".ginput_mollie_payment_method select option").length?(this.isCreditCardMethodSelected(e)?this.form.find(".ginput_mollie_payment_method"):this.form.find(".gfield_mollie")).hide():this.form.find(".gfield_mollie").css("display","")},this.maybeShowCcFields=function(e){this.isCreditCardMethodSelected(e)?(this.showCcFields(),this.createMollieComponents(),this.mountMollieComponents()):this.hideCcFields()},this.isGoPrevPage=function(e){var t=parseInt(r("#gform_source_page_number_"+e).val(),10),e=parseInt(r("#gform_target_page_number_"+e).val(),10);return e<t&&0!==e},this.showCcFields=function(){this.form.find(".ginput_container_mollie_components").removeClass("gf_invisible")},this.hideCcFields=function(){this.form.find(".ginput_container_mollie_components").addClass("gf_invisible")},this.showError=function(e){0<r("#gform_ajax_spinner_"+this.formId).length&&r("#gform_ajax_spinner_"+this.formId).remove(),r(this.ccfields).addClass("gfield_error"),r(this.ccfields).find(".validation_message").length||r(this.ccfields).append('<div class="gfield_description gfield_validation_message validation_message"></div>');var t=r(this.ccfields).find(".validation_message"),i=gform_mollie_components_strings.errorprefix;e.message&&(i=i+": "+e.message),s.cardHasError[e.type]=e.message||"",t.text(i),wp.a11y.speak(i)},this.clearError=function(){r(this.ccfields).removeClass("gfield_error").find(".validation_message").remove()},this.addTokenInputToForm=function(e,t){var i;0===r("#gform_"+t+" input[name=cardToken]").length&&((i=document.createElement("input")).setAttribute("type","hidden"),i.setAttribute("name","cardToken"),this.form.append(i)),this.setCardToken(e,t)},this.setCardToken=function(e,t){r("#gform_"+t+" input[name=cardToken]").val(e)},this.getCardToken=function(e){e=r("#gform_"+e+" input[name=cardToken]");return 1===e.length&&""!==e.val()&&e.val()},this.clearCardToken=function(e){r("#gform_"+e+" input[name=cardToken]").val("")},this.isPaymentFieldOnPage=function(){var e=this.getCurrentPageNumber();return!(!r("#input_"+this.formId+"_"+this.ccFieldId+"_1").length||this.pmfieldPage&&e&&!this.isConversationalForm()&&this.pmfieldPage!=e)},this.getCurrentPageNumber=function(){var e=r("#gform_source_page_number_"+this.formId);return 0<e.length&&e.val()},this.isLastPage=function(){var e=r("#gform_target_page_number_"+this.formId);return!(0<e.length)||"0"===e.val()},this.resetMollieStatus=function(){r(this.form).data("gfmolliesubmitting",!1),r("#gform_ajax_spinner_"+this.formId).remove(),this.isLastPage()&&(window["gf_submitting_"+this.formId]=!1),this.clearCardToken(this.formId)},this.init()}}(jQuery);